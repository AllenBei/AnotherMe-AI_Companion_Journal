#user  nobody;
worker_processes  1;
user root;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  5000;
}


http {
    include                         mime.types;
    default_type                application/octet-stream;
        sendfile                    on;
        keepalive_timeout       120;
        gzip                on;
        server_tokens           off;
        client_max_body_size 500m;
    map                 $http_upgrade   $connection_upgrade {
        default         upgrade;
        ''              close;
    }
    server {
        listen 443 ssl;
        server_name         dance.dancefit.app;
        #charset             UTF-8;
        root html;
        index index.html index.htm;
        ssl_certificate cert/dance.dancefit.app.pem;  #需要将cert-file-name.pem替换成已上传的证书文件的名称。
        ssl_certificate_key  cert/dance.dancefit.app.key; #需要将cert-file-name.key替换成已上传的证书密钥文件的名称。
                ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
                #表示使用的加密套件的类型。
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #表示使用的TLS协议的类型。
                ssl_prefer_server_ciphers on;
      

                location / {
            proxy_pass                  http://app;
            proxy_redirect              off;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP         $remote_addr;
            proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_http_version  1.1;
            proxy_set_header    Upgrade $http_upgrade;
            proxy_set_header    Connection "upgrade";
        }


    }  
        server {
        listen 443 ssl;
        server_name         v.dancefit.app;
        #charset             UTF-8;
        root html;
        index index.html index.htm;
        ssl_certificate cert/v.dancefit.app.pem;  #需要将cert-file-name.pem替换成已上传的证书文件的名称。
        ssl_certificate_key cert/v.dancefit.app.key; #需要将cert-file-name.key替换成已上传的证书密钥文件的名称。
                ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
                #表示使用的加密套件的类型。
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #表示使用的TLS协议的类型。
                ssl_prefer_server_ciphers on;
      

                location / {
            root  /home/code/shares/dist;
                        index index.html index.htm;
        }

    }
        server {
        listen 443 ssl;
        server_name         www.dancefit.app;
        #charset             UTF-8;
        root html;
        index index.html index.htm;
        ssl_certificate cert/www.dancefit.apps.pem;  #需要将cert-file-name.pem替换成已上传的证书文件的名称。
        ssl_certificate_key cert/www.dancefit.apps.key; #需要将cert-file-name.key替换成已上传的证书密钥文件的名称。
                ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
                #表示使用的加密套件的类型。
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #表示使用的TLS协议的类型。
                ssl_prefer_server_ciphers on;
      

                location / {
            root  /home/code/webside/dist;
                        index index.html index.htm;
                        try_files $uri $uri/ /index.html;
        }
                #location / {
        #    root  /home/code/games;
                #       index index.html index.htm;
                #       try_files $uri $uri/ /index.html;
        #}

    }    

        server {
        listen 80;
        server_name         dance.dancefit.app;
        #charset             UTF-8;
        root html;
        index index.html index.htm;

                location / {
            proxy_pass                  http://app;
            proxy_redirect              off;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP         $remote_addr;
            proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_http_version  1.1;
            proxy_set_header    Upgrade $http_upgrade;
            proxy_set_header    Connection "upgrade";
        }


    }  

#       server {
 #   listen 80;
 #   server_name dance.dancefit.app; #需要将yourdomain替换成证书绑定的域名。
#   rewrite ^(.*)$ https://$host$1; #将所有HTTP请求通过rewrite指令重定向到HTTPS。
#               location / {
  #      index index.html index.htm;
#               }
#       }

# HTTP 配置 - anotherme.life
    server {
        listen 80;
        server_name anotherme.life www.anotherme.life;
                
        location / {
            proxy_pass http://127.0.0.1:3000;
            proxy_redirect off;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_buffer_size 16k;
            proxy_buffers 8 16k;
            proxy_busy_buffers_size 24k;
        }
    }

# HTTPS 配置
    server {
        listen 443 ssl;
        server_name anotherme.life www.anotherme.life;

        location / {
            proxy_pass http://127.0.0.1:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $host;
            proxy_cache_bypass $http_upgrade;
            proxy_buffer_size 16k;
            proxy_buffers 8 16k;
            proxy_busy_buffers_size 24k;
        }

        ssl_certificate /etc/letsencrypt/live/anotherme.life/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/anotherme.life/privkey.pem;
        include /etc/letsencrypt/options-ssl-nginx.conf;
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    }
    upstream app {
        server 127.0.0.1:8081;
    } 

}